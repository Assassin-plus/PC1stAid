---
title: 多用户同时登录RDP如何食用
description: 
published: true
date: 2022-11-10T09:15:08.550Z
tags: 
editor: markdown
dateCreated: 2022-11-09T06:35:54.961Z
---

# Windows 远程桌面同时登录多个用户的配置方法

太长，我懒得看：
- 多用户的远程桌面能让不同的人同时利用一台计算机的资源
- 微软的远程桌面比 VNC 先进，谁赞成，谁反对？
- 微软在教育版/企业版/专业版/专业工作站系统上禁用了多用户远程桌面功能
- 本教程可以教会你魔改任何一台 Windows 设备，实现多用户远程桌面
- 详细修改功能的过程还是别跳过了吧

## 海记忆体知己，天涯若比邻。为什么你需要多用户？
  
> 同一时间内允许多个用户同时使用计算机,称为多用户操作系统; 反之，同一时间内最多允许一个用户操作计算机，则称为单用户操作系统。 
> <p align="right">--摘自百度百科</p>

举例来说，你们实验室现存一台服务器（其实就是个配置稍微好点、风力稍微大点的台式机）。Alice 希望用它来爬数据，Bob 希望它能做仿真，Carol 希望它能跑 ~~NovelAI~~ 计算机视觉相关应用，你们的老板希望都能跑，因为三个人的东西都跑不起来的话他就得跑  
  
但显然你们的老板没有钱再多买几台服务器，否则你们实验室应该有至少三台服务器了
 
你们老板大手一挥，给服务器装上了高级的 Linux 系统，并且要求你们用 Putty、Xshell 或者 openssh 这类工具登陆进去
发现了吗，你们的实验室就好像有了三台服务器，在除了 Bob 占满24核心并行仿真的时间之外，其他人的使用从来不会影响你的任务


但 Carol 并不满意，因为 Linux 里面图形界面都又丑又慢，尤其是老板选择了最返璞归真的 Xfce 桌面，图标就是个大黑耗子实在不怎么高级。众所周知，Linux 的 X11、VNC 和微软家的远程桌面一比 ~~就是一坨~~ 进步空间还很大 

为什么不试试 Windows 呢？微软早都帮你想好了，在 Windows Server 上也可以使用 SSH、RDP 等协议多用户登录


> 说干就干，Carol 将服务器装成了他最熟悉的`视窗®10作业系统`
{.is-success}

意想不到的事情发生了，Carol 发现他们安装的 Windows 系统是家庭和学生版，完全没有远程桌面主机可用，与“既要又要”原则相悖

那么，本着既要又要的原则，这个实验室能不能在家庭和学生版的 Windows 上实现多用户同时登录捏？  

  
![wqdy.jpg](/system/windows/img/multiRDP_wqdy.jpg)

## 千红万紫安排著，只待新雷第一声。请先将你的视窗®作业系统切换到教育版/企业版/专业版/专业工作站版


Alice 建议 Carol 参考 [KMS 服务激活系统](https://github.com/netnr/kms)的方法来更改系统版本
  
Carol 拒绝了 Alice 的建议，并且在晚上七点把服务器搬到了 C 楼224房间，恰好赶上科技服务队开工，科技服务队欣然帮 Carol 将系统切换成为专业版
（注：部分 OEM 系统无法无损地切换）

Carol 没有忘记新建用户 Alice 和 Bob ，然后在 `Windows 设置->系统->远程桌面`里开启远程，并给与 Alice 和 Bob 远程桌面权限

> 聪明的 Carol 拿自己的笔记本做了个验证，服务器确实能够通过远程桌面登录了。他向 Alice 和 Bob 宣布了这一喜讯，服务器呜呜呜地转个不停。
{.is-success}

幸福倒计时，意想不到的事情发生了，当 Carol 试图登录 Bob 正在仿真的 windows 系统服务器时，Bob 进度到99%仿真终止了，这差点导致实验室友好氛围的消失 
  
查阅资料后发现，微软认为一般的用户根本不会用到多用户同时登录的远程桌面，费尽心思地帮你把这个功能从家庭版/企业版/专业版/专业工作站版移除了，这使得 Carol 登录进服务器后 Bob 的账号被踢下线了，仿真也自然的不见了  



## 年年岁岁花相似，岁岁年年人不同。我们邀请你开始全新的组策略编辑

> 聪明的 Carol 早就拿自己的笔记本做了个验证，服务器确实能够通过远程桌面登录

Carol 同时按下键盘上的 `win` 键和 `r` 键，输入 `gpedit.msc` 以启动组策略编辑器，找到了`计算机配置->管理模板->Windows 组件->远程桌面服务->远程桌面会话主机->连接`。
1. 将`限制连接的数量`设置为`已启用`，同时在选项里面`允许的 RD 最大连接数`设置为你想要的数量，此处是所有用户的连接数
2. 将`将远程桌面服务用户限制到单独的远程桌面服务会话`设置为`已启用`，这会避免同一用户多个桌面带来的后台问题

## 剑阁峥嵘而崔嵬，一夫当关，万夫莫开。修改和替换系统文件

> 请务必备份好修改前的 `termsrv.dll` 和其他重要数据，按照此教程操作导致的系统炸飞，我们可不负责哟
{.is-danger}

即使改了上述组策略，Carol 发现也不能实现多用户同时使用远程桌面，使用远程登录已被登录的主机时，会提示必须下线已经登录的用户  

为了实现多用户同时使用且互不干扰，需要手动魔改 Windows 操作系统的`C:\Windows\System32\termsrv.dll`文件  

Carol进入了`PE系统`，在`HEX编辑器`打开了这个文件，搜索到了下面显示的字符串
`39 81 3C 06 00 00 0F 84 XX XX XX XX`（最后四组XX可以是任何数字）

> 根据系统版本，实际上可能是如下内容，不建议对32位系统做类似修改，因为我们没对32位系统做过类似的测试
> Windows 10 x64 2004: `39 81 3C 06 00 00 0F 84 D9 51 01 00`  
> Windows 10 x64 1909: `39 81 3C 06 00 00 0F 84 5D 61 01 00` 
> Windows 10 x64 1903: `39 81 3C 06 00 00 0F 84 5D 61 01 00`  
> Windows 10 x64 1809: `39 81 3C 06 00 00 0F 84 3B 2B 01 00`  
> Windows 10 x64 1803: `8B 99 3C 06 00 00 8B B9 38 06 00 00`  
> Windows 10 x64 1709: `39 81 3C 06 00 00 0F 84 B1 7D 02 00`  

并将上述内容替换为： `B8 00 01 00 00 89 81 38 06 00 00 90`   

保存并覆盖系统原始 `termsrv.dll` 文件，Carol 终于可以在不打断 Bob 仿真的同时开展他的计算机图形学研究了


## 你觉得好麻烦，坐和放宽，我们为你提供了更经过精挑细选的方法，确保让你爱不释手。

时间线回到 Carol 修改神秘的 `termsrv.ddl` 之前。Bob 宣布重新与 Carol 建交并给 Carol 推荐了这个 [repo](https://github.com/sebaxakerhtc/rdpwrap)，别人已经造好的轮子，为什么还要自己重新造一遍呢。

Carol `临时地关闭了杀毒软件`，下载并`使用管理员身份运行 Releases 中的脚本`，Carol 终于可以在不打断 Bob 仿真的同时开展他的计算机图形学研究了

## 苟日新，又日新，你们已经完成了这一部分设置，快来试试多用户远程桌面吧！  
  
  
  
  
> 我们真的在使用一种很新的语言，如果您愿意冒险尝试，欢迎学习 zh_M$ 以获得更多快乐
> 这里有一些很棒的资料，比棒还棒
> <https://www.zhihu.com/question/39569160> | <https://b23.tv/Zme11lv>



